from matterstack.core.candidate import Candidate
from matterstack.core.operators import register_simulator
from matterstack.runtime.context import RuntimeContext, HPCClient, LabClient
from matterstack.runtime.execution import execute_batch

@register_simulator(name="sim_identity", tier="cheap")
def sim_identity(candidate, env, ctx):
    return {"score": candidate.params["x"]}

def test_execute_batch():
    ctx = RuntimeContext(hpc=HPCClient(), lab=LabClient())
    c1 = Candidate(id="c1", params={"x": 1})
    c2 = Candidate(id="c2", params={"x": 2})

    results = execute_batch("sim_identity", [c1, c2], None, ctx)
    assert results["c1"]["score"] == 1
    assert results["c2"]["score"] == 2