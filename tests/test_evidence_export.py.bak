from matterstack.core.evidence import EvidenceBundle, EvidenceNode
from matterstack.core.candidate import Candidate
from matterstack.storage.export import export_evidence_json, export_markdown_report
from pathlib import Path
import json
import tempfile

def test_export_evidence(tmp_path: Path):
    bundle = EvidenceBundle(campaign_name="test")
    bundle.nodes.append(
        EvidenceNode(id="n1", type="candidate", data={"params": {"x": 1}})
    )
    json_path = tmp_path / "evidence.json"
    md_path = tmp_path / "report.md"
    export_evidence_json(bundle, str(json_path))
    export_markdown_report(bundle, [Candidate(id="c1", params={"x": 1}, metrics={"score": 0.5})],
                           "score", str(md_path))

    assert json_path.exists()
    assert md_path.exists()
    obj = json.loads(json_path.read_text())
    assert obj["campaign_name"] == "test"